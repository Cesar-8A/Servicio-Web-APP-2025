{% extends "home.html" %}

{% block content %}
    {% if success == 0 %}
        <h1>Carga primero una imagen</h1>
    {% else %}
        <h1>Visualizacion DICOM</h1>
        <p>Renderizado de la imagen cargada.</p>
        <!-- Contenedor para el iframe con estilo centrado y borde grueso -->
        <div style="width: 400px; margin: 0 auto; padding: 10px; border: dotted 5px  black;">
            <iframe src="http://127.0.0.1:5010/panel" id="DicomRender" width="400" height="500" style="border: 5px steelblue;"></iframe>
        </div>


        <div>
            <h3>Vista Axial</h3>
            <input type="range" id="slider_axial" min="0" max="{{ max_value_axial }}" step="1" value="{{max_value_axial//2}}" />
            <input type="number" id="number_axial" min="0" max="{{ max_value_axial }}" step="1" value="{{max_value_axial//2}}" />
            <img id="image_axial" src="/image/axial/0" alt="Vista Axial" width="500" />
          </div>
        
          <div>
            <h3>Vista Sagital</h3>
            <input type="range" id="slider_sagital" min="0" max="{{ max_value_sagital }}" step="1" value="{{max_value_sagital//2}}" />
            <input type="number" id="number_sagital" min="0" max="{{ max_value_sagital }}" step="1" value="{{max_value_sagital//2}}" />
            <img id="image_sagital" src="/image/sagital/0" alt="Vista Sagital" width="500" />
          </div>
        
          <div>
            <h3>Vista Coronal</h3>
            <input type="range" id="slider_coronal" min="0" max="{{ max_value_coronal }}" step="1" value="{{max_value_coronal//2}}" />
            <input type="number" id="number_coronal" min="0" max="{{ max_value_coronal }}" step="1" value="{{max_value_coronal//2}}" />
            <img id="image_coronal" src="/image/coronal/0" alt="Vista Coronal" width="500" />
          </div>
        
          <script>
            function setupSlider(view) {
              const slider = document.getElementById(`slider_${view}`);
              const number = document.getElementById(`number_${view}`);
              const image = document.getElementById(`image_${view}`);
        
              function updateImage(layer) {
                image.src = `/image/${view}/${layer}?t=${new Date().getTime()}`;
              }
        
              slider.addEventListener('input', () => {
                number.value = slider.value;
                updateImage(slider.value);
              });
        
              number.addEventListener('input', () => {
                let val = Number(number.value);
                if (val < slider.min) val = slider.min;
                if (val > slider.max) val = slider.max;
                slider.value = val;
                updateImage(val);
              });
            }
        
            setupSlider('axial');
            setupSlider('sagital');
            setupSlider('coronal');
          </script>



        <div>
            <h2>Subir RT Struct (NRRD)</h2>
            <form action="/upload_RT" method="post" enctype="multipart/form-data">
                <input type="file" name="file" accept=".nrrd">
                <button type="submit">Subir</button>
            </form>

            
        </div>





        <script>
            document.getElementById("uploadForm").addEventListener("submit", function(event) {
                event.preventDefault();  // Evita que la p√°gina se recargue

                let formData = new FormData(this);  // Captura los datos del formulario

                fetch("/upload_RT", {
                    method: "POST",
                    body: formData
                });

                // Opcional: Mostrar un mensaje sin esperar respuesta
                alert("Archivo cargado.");
            });
        </script>
    {% endif %}
{% endblock %}